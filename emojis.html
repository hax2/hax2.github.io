<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spanish Emoji Game 🇪🇸</title>

    <style>
        /* --- General Styling --- */
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f0f7f2;
            color: #333;
            margin: 0;
            -webkit-font-smoothing: antialiased;
        }

        #game-container {
            width: 90%;
            max-width: 600px;
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        h1 {
            color: #2a7f40;
        }
        
        h2 {
            text-transform: capitalize;
        }

        .screen {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .hidden {
            display: none;
        }

        .btn {
            padding: 12px 24px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            background-color: #4CAF50;
            color: white;
            transition: background-color 0.3s, transform 0.2s;
        }

        .btn:hover {
            background-color: #45a049;
            transform: translateY(-2px);
        }

        /* --- Game Area Specifics --- */
        #status-bar {
            display: flex;
            justify-content: space-between;
            font-size: 1.1rem;
            font-weight: bold;
            color: #555;
            padding-bottom: 1rem;
            border-bottom: 2px solid #eee;
        }

        #prompt-area {
            min-height: 120px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        /* --- EMOJI Styling --- */
        #emoji-prompt-2, #emoji-prompt-3 {
            font-size: 8rem; /* Large emoji for Levels 2 & 3 */
            line-height: 1;
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 1rem;
            width: 100%;
        }

        .emoji-option {
            font-size: 4rem; /* Big emojis for clicking in Level 1 */
            padding: 10px;
            background-color: #f9f9f9;
            border: 2px solid #ddd;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s, border-color 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .emoji-option:hover {
            transform: scale(1.1);
            border-color: #4CAF50;
        }
        
        /* --- Prompts & Options by Level --- */
        #level-1-prompt-area {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
        }

        #word-prompt {
            font-size: 3rem;
            margin: 0;
            color: #d9534f;
            text-transform: capitalize;
        }

        #speak-button {
            font-size: 2rem;
            background: none;
            border: none;
            cursor: pointer;
            padding: 0;
            line-height: 1;
        }
        
        .options-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 80%;
            margin: 0 auto;
        }

        .name-option-btn {
            padding: 12px;
            font-size: 1.2rem;
            cursor: pointer;
            border: 2px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
            transition: background-color 0.3s, border-color 0.3s;
            text-transform: capitalize;
        }

        .name-option-btn:hover {
            background-color: #e9e9e9;
            border-color: #ccc;
        }

        #text-input-area {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        #text-answer {
            padding: 10px;
            font-size: 1.2rem;
            border: 2px solid #ccc;
            border-radius: 8px;
            width: 250px;
        }

        #feedback {
            min-height: 30px;
            font-size: 1.5rem;
            font-weight: bold;
            margin-top: 1rem;
        }

        .correct {
            color: #5cb85c;
        }

        .incorrect {
            color: #d9534f;
        }

    </style>
</head>
<body>

    <div id="game-container">
        <!-- Start Screen -->
        <div id="start-screen" class="screen">
            <h1>Juego de Emojis en Español 🇪🇸</h1>
            <p>Learn Spanish vocabulary by matching words to emojis!</p>
            <button id="start-button" class="btn">Start Game 🚀</button>
        </div>

        <!-- Level Select Screen -->
        <div id="level-select-screen" class="screen hidden">
            <h2>Selecciona el nivel</h2>
            <div style="display: flex; flex-wrap: wrap; gap: 1rem; justify-content: center;">
                <button class="btn" id="level-1-select">Nivel 1</button>
                <button class="btn" id="level-2-select">Nivel 2</button>
                <button class="btn" id="level-3-select">Nivel 3</button>
            </div>
            <button class="btn" id="back-to-start">Volver al inicio</button>
        </div>

        <!-- Level 1 Screen -->
        <div id="level-1-screen" class="screen hidden">
            <div id="status-bar-1" class="status-bar"></div>
            <div id="level-1-prompt-area" class="prompt-content">
                <h2 id="word-prompt"></h2>
                <button id="speak-button" title="Hear the word">🔊</button>
            </div>
            <div id="emoji-options" class="options-grid"></div>
            <div id="feedback-1" class="feedback"></div>
            <button class="btn" id="change-level-1">Cambiar nivel</button>
        </div>

        <!-- Level 2 Screen -->
        <div id="level-2-screen" class="screen hidden">
            <div id="status-bar-2" class="status-bar"></div>
            <div id="prompt-area">
                <div id="emoji-prompt-2"></div>
            </div>
            <div id="name-options" class="options-list"></div>
            <div id="feedback-2" class="feedback"></div>
            <button class="btn" id="change-level-2">Cambiar nivel</button>
        </div>

        <!-- Level 3 Screen -->
        <div id="level-3-screen" class="screen hidden">
            <div id="status-bar-3" class="status-bar"></div>
            <div id="prompt-area">
                <div id="emoji-prompt-3"></div>
            </div>
            <div id="text-input-area">
                <input type="text" id="text-answer" placeholder="Escribe el nombre aquí..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
                <button id="submit-answer" class="btn">Check</button>
            </div>
            <div id="feedback-3" class="feedback"></div>
            <button class="btn" id="change-level-3">Cambiar nivel</button>
        </div>

        <!-- End Screen -->
        <div id="end-screen" class="screen hidden">
            <h1>¡Juego Terminado! 🎉</h1>
            <p id="final-score"></p>
            <button id="play-again-button" class="btn">Play Again</button>
            <button class="btn" id="end-change-level">Cambiar nivel</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- DATA: Expanded list of emojis ---
            const EMOJI_DATA = [
                // Fruits & Vegetables
                { spanish: 'la manzana', emoji: '🍏' }, { spanish: 'el plátano', emoji: '🍌' }, { spanish: 'las uvas', emoji: '🍇' },
                { spanish: 'la fresa', emoji: '🍓' }, { spanish: 'la naranja', emoji: '🍊' }, { spanish: 'el limón', emoji: '🍋' },
                { spanish: 'la zanahoria', emoji: '🥕' }, { spanish: 'el tomate', emoji: '🍅' }, { spanish: 'la patata', emoji: '🥔' },
                { spanish: 'la cebolla', emoji: '🧅' }, { spanish: 'la sandía', emoji: '🍉' }, { spanish: 'la pera', emoji: '🍐' },
                { spanish: 'el aguacate', emoji: '🥑' }, { spanish: 'la piña', emoji: '🍍' }, { spanish: 'la cereza', emoji: '🍒' },
                { spanish: 'el pimiento', emoji: '🫑' }, { spanish: 'el maíz', emoji: '🌽' }, { spanish: 'el brócoli', emoji: '🥦' },
                // Animals
                { spanish: 'el perro', emoji: '🐶' }, { spanish: 'el gato', emoji: '🐱' }, { spanish: 'el ratón', emoji: '🐭' },
                { spanish: 'el zorro', emoji: '🦊' }, { spanish: 'el oso', emoji: '🐻' }, { spanish: 'el panda', emoji: '🐼' },
                { spanish: 'el león', emoji: '🦁' }, { spanish: 'el tigre', emoji: '🐯' }, { spanish: 'la vaca', emoji: '🐮' },
                { spanish: 'el cerdo', emoji: '🐷' }, { spanish: 'el mono', emoji: '🐵' }, { spanish: 'el pollo', emoji: '🐔' },
                { spanish: 'el pingüino', emoji: '🐧' }, { spanish: 'la rana', emoji: '🐸' }, { spanish: 'el pulpo', emoji: '🐙' },
                { spanish: 'el pez', emoji: '🐠' }, { spanish: 'la ballena', emoji: '🐳' }, { spanish: 'el caballo', emoji: '🐴' },
                // Food & Drink
                { spanish: 'la pizza', emoji: '🍕' }, { spanish: 'la hamburguesa', emoji: '🍔' }, { spanish: 'las papas fritas', emoji: '🍟' },
                { spanish: 'el pan', emoji: '🍞' }, { spanish: 'el queso', emoji: '🧀' }, { spanish: 'el huevo', emoji: '🥚' },
                { spanish: 'el helado', emoji: '🍦' }, { spanish: 'la dona', emoji: '🍩' }, { spanish: 'la galleta', emoji: '🍪' },
                { spanish: 'el pastel', emoji: '🍰' }, { spanish: 'el chocolate', emoji: '🍫' }, { spanish: 'el café', emoji: '☕' },
                // Objects
                { spanish: 'el coche', emoji: '🚗' }, { spanish: 'la bicicleta', emoji: '🚲' }, { spanish: 'el cohete', emoji: '🚀' },
                { spanish: 'el teléfono', emoji: '📱' }, { spanish: 'el ordenador', emoji: '💻' }, { spanish: 'la televisión', emoji: '📺' },
                { spanish: 'el libro', emoji: '📖' }, { spanish: 'el dinero', emoji: '💰' }, { spanish: 'la llave', emoji: '🔑' },
                { spanish: 'la bomba', emoji: '💣' }, { spanish: 'la guitarra', emoji: '🎸' }, { spanish: 'la pelota', emoji: '⚽' },
                // Nature & Places
                { spanish: 'el sol', emoji: '☀️' }, { spanish: 'la luna', emoji: '🌙' }, { spanish: 'la estrella', emoji: '⭐' },
                { spanish: 'el volcán', emoji: '🌋' }, { spanish: 'la montaña', emoji: '⛰️' }, { spanish: 'la casa', emoji: '🏠' },
                { spanish: 'el castillo', emoji: '🏰' }, { spanish: 'la playa', emoji: '🏖️' }, { spanish: 'el árbol', emoji: '🌳' },
                { spanish: 'la flor', emoji: '🌸' }, { spanish: 'el fuego', emoji: '🔥' }, { spanish: 'el arcoíris', emoji: '🌈' },
                // Activities & Symbols
                { spanish: 'el corazón', emoji: '❤️' }, { spanish: 'el cerebro', emoji: '🧠' }, { spanish: 'el fantasma', emoji: '👻' },
                { spanish: 'el robot', emoji: '🤖' }, { spanish: 'el extraterrestre', emoji: '👽' }, { spanish: 'la corona', emoji: '👑' }
            ];

            // --- GAME STATE ---
            let currentLevel = 1;
            let score = 0;
            let currentQuestionIndex = 0;
            let gameData = [];
            const TOTAL_QUESTIONS_PER_ROUND = 15; // Set a reasonable number of questions per game round

            // --- DOM ELEMENTS ---
            const startScreen = document.getElementById('start-screen');
            const levelSelectScreen = document.getElementById('level-select-screen');
            const level1Screen = document.getElementById('level-1-screen');
            const level2Screen = document.getElementById('level-2-screen');
            const level3Screen = document.getElementById('level-3-screen');
            const endScreen = document.getElementById('end-screen');
            const startButton = document.getElementById('start-button');
            const playAgainButton = document.getElementById('play-again-button');
            const level1Select = document.getElementById('level-1-select');
            const level2Select = document.getElementById('level-2-select');
            const level3Select = document.getElementById('level-3-select');
            const backToStart = document.getElementById('back-to-start');
            const changeLevelButtons = document.querySelectorAll('#change-level-1, #change-level-2, #change-level-3, #end-change-level');
            const statusBar1 = document.getElementById('status-bar-1');
            const statusBar2 = document.getElementById('status-bar-2');
            const statusBar3 = document.getElementById('status-bar-3');
            const wordPrompt = document.getElementById('word-prompt');
            const speakButton = document.getElementById('speak-button');
            const emojiPrompt2 = document.getElementById('emoji-prompt-2');
            const emojiPrompt3 = document.getElementById('emoji-prompt-3');
            const emojiOptions = document.getElementById('emoji-options');
            const nameOptions = document.getElementById('name-options');
            const textAnswerInput = document.getElementById('text-answer');
            const submitAnswerButton = document.getElementById('submit-answer');
            const feedback1 = document.getElementById('feedback-1');
            const feedback2 = document.getElementById('feedback-2');
            const feedback3 = document.getElementById('feedback-3');
            const finalScoreDisplay = document.getElementById('final-score');
            
            // --- HELPER FUNCTIONS ---
            
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            function speak(text) {
                if (!window.speechSynthesis) {
                    console.warn("Speech Synthesis not supported in this browser.");
                    return;
                }
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'es-ES';
                utterance.rate = 0.9;
                const voices = window.speechSynthesis.getVoices();
                const esVoice = voices.find(v => v.lang.startsWith('es'));
                if (esVoice) utterance.voice = esVoice;
                window.speechSynthesis.speak(utterance);
            }
            
            function levenshteinDistance(a, b) {
                if (a.length === 0) return b.length;
                if (b.length === 0) return a.length;
                const matrix = Array.from({ length: b.length + 1 }, (_, i) => [i]);
                for (let j = 1; j <= a.length; j++) { matrix[0][j] = j; }
                for (let i = 1; i <= b.length; i++) {
                    for (let j = 1; j <= a.length; j++) {
                        const cost = b.charAt(i - 1) === a.charAt(j - 1) ? 0 : 1;
                        matrix[i][j] = Math.min(
                            matrix[i - 1][j] + 1,        // Deletion
                            matrix[i][j - 1] + 1,        // Insertion
                            matrix[i - 1][j - 1] + cost  // Substitution
                        );
                    }
                }
                return matrix[b.length][a.length];
            }

            // --- GAME LOGIC ---

            function startGame(selectedLevel) {
                score = 0;
                currentLevel = selectedLevel;
                currentQuestionIndex = 0;
                gameData = shuffleArray([...EMOJI_DATA]).slice(0, TOTAL_QUESTIONS_PER_ROUND);
                showScreen('level-' + currentLevel);
                loadQuestion();
            }

            function showScreen(screenId) {
                [startScreen, levelSelectScreen, level1Screen, level2Screen, level3Screen, endScreen].forEach(s => s.classList.add('hidden'));
                const screenToShow = document.getElementById(screenId + '-screen');
                if (screenToShow) screenToShow.classList.remove('hidden');
            }

            function updateStatus(level) {
                const statusBar = document.getElementById(`status-bar-${level}`);
                statusBar.innerHTML = `<span>Pregunta: ${currentQuestionIndex + 1} / ${gameData.length}</span><span>Puntos: ${score}</span>`;
            }

            function loadQuestion() {
                if (currentQuestionIndex >= gameData.length) {
                    showScreen('end');
                    finalScoreDisplay.textContent = `Tu puntuación final es ${score} de ${gameData.length}.`;
                    return;
                }
                
                feedback1.textContent = '';
                feedback2.textContent = '';
                feedback3.textContent = '';
                
                const currentItem = gameData[currentQuestionIndex];
                updateStatus(currentLevel);
                
                switch (currentLevel) {
                    case 1: setupLevel1(currentItem); break;
                    case 2: setupLevel2(currentItem); break;
                    case 3: setupLevel3(currentItem); break;
                }
            }

            // --- LEVEL SETUPS ---

            function setupLevel1(item) {
                wordPrompt.textContent = item.spanish;
                speak(item.spanish);
                speakButton.onclick = () => speak(item.spanish);

                emojiOptions.innerHTML = '';
                const distractors = EMOJI_DATA.filter(d => d.emoji !== item.emoji).sort(() => 0.5 - Math.random()).slice(0, 5);
                const options = shuffleArray([item, ...distractors]);
                
                options.forEach(opt => {
                    const emojiDiv = document.createElement('div');
                    emojiDiv.textContent = opt.emoji;
                    emojiDiv.className = 'emoji-option';
                    emojiDiv.dataset.spanish = opt.spanish;
                    emojiDiv.onclick = (e) => checkAnswer(e.target.dataset.spanish === item.spanish, 1);
                    emojiOptions.appendChild(emojiDiv);
                });
            }

            function setupLevel2(item) {
                emojiPrompt2.textContent = item.emoji;
                nameOptions.innerHTML = '';
                const distractors = EMOJI_DATA.filter(d => d.spanish !== item.spanish).sort(() => 0.5 - Math.random()).slice(0, 3);
                const options = shuffleArray([item, ...distractors]);
                
                options.forEach(opt => {
                    const button = document.createElement('button');
                    button.textContent = opt.spanish;
                    button.classList.add('name-option-btn');
                    button.onclick = () => checkAnswer(opt.spanish === item.spanish, 2);
                    nameOptions.appendChild(button);
                });
            }

            function setupLevel3(item) {
                emojiPrompt3.textContent = item.emoji;
                textAnswerInput.value = '';
                textAnswerInput.disabled = false;
                submitAnswerButton.disabled = false;
                textAnswerInput.focus();

                const checkSpelling = () => {
                    const userAnswer = textAnswerInput.value.trim().toLowerCase();
                    if (!userAnswer) return;
                    
                    const correctAnswerFull = item.spanish.toLowerCase();
                    const correctAnswerSimple = correctAnswerFull.replace(/^(el|la|los|las)\s+/i, '');
                    const userAnswerSimple = userAnswer.replace(/^(el|la|los|las)\s+/i, '');

                    // Allow for a small typo (Levenshtein distance <= 1)
                    // Or an exact match of the simple form (e.g., "manzana" for "la manzana")
                    // Or an exact match of the full form (e.g., "la manzana")
                    const isCorrect = levenshteinDistance(userAnswerSimple, correctAnswerSimple) <= 1 ||
                                      userAnswerSimple === correctAnswerSimple ||
                                      userAnswer === correctAnswerFull;

                    checkAnswer(isCorrect, 3, item.spanish);
                };

                submitAnswerButton.onclick = checkSpelling;
                textAnswerInput.onkeydown = (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault(); // Prevent form submission
                        checkSpelling();
                    }
                };
            }

            // --- ANSWER CHECKING & PROGRESSION ---

            function checkAnswer(isCorrect, level, correctAnswer) {
                const feedbackEl = document.getElementById(`feedback-${level}`);
                const answer = correctAnswer || gameData[currentQuestionIndex].spanish;
                
                if (isCorrect) {
                    score++;
                    feedbackEl.textContent = `¡Correcto! 👍`;
                    feedbackEl.className = 'feedback correct';
                } else {
                    feedbackEl.textContent = `Incorrecto. La respuesta es: ${answer}`;
                    feedbackEl.className = 'feedback incorrect';
                }
                
                updateStatus(level);
                disableInputsForFeedback(level);

                setTimeout(() => {
                    currentQuestionIndex++;
                    loadQuestion();
                }, 2000);
            }
            
            function disableInputsForFeedback(level) {
                 if (level === 1) {
                    document.querySelectorAll('#emoji-options .emoji-option').forEach(el => el.style.pointerEvents = 'none');
                } else if (level === 2) {
                    document.querySelectorAll('#name-options button').forEach(btn => btn.disabled = true);
                } else if (level === 3) {
                    submitAnswerButton.disabled = true;
                    textAnswerInput.disabled = true;
                }
            }


            // --- EVENT LISTENERS ---
            startButton.addEventListener('click', () => showScreen('level-select'));
            backToStart.addEventListener('click', () => showScreen('start'));
            
            level1Select.addEventListener('click', () => startGame(1));
            level2Select.addEventListener('click', () => startGame(2));
            level3Select.addEventListener('click', () => startGame(3));
            
            playAgainButton.addEventListener('click', () => startGame(currentLevel));

            changeLevelButtons.forEach(button => {
                button.addEventListener('click', () => showScreen('level-select'));
            });
        });
    </script>
</body>
</html>